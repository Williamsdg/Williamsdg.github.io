<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Drake Injury Lawyers | Case Management Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#7c3aed;--primary-dark:#1e1145;--primary-light:#ede9fe;--white:#fff;--g50:#f8fafc;--g100:#f1f5f9;--g200:#e2e8f0;--g300:#cbd5e1;--g400:#94a3b8;--g500:#64748b;--g700:#334155;--g800:#1e293b;--g900:#0f172a;--green:#16a34a;--green-l:#dcfce7;--orange:#f97316;--orange-l:#fff7ed;--red:#ef4444;--red-l:#fef2f2;--blue:#2563eb;--blue-l:#eff6ff;--r:12px}
        html{scroll-behavior:smooth}
        body{font-family:'Inter',system-ui,sans-serif;background:var(--g100);color:var(--g900);line-height:1.5;min-height:100vh}
        .layout{display:flex;min-height:100vh}
        .sidebar{width:260px;background:var(--primary-dark);color:var(--white);position:fixed;top:0;left:0;bottom:0;display:flex;flex-direction:column;z-index:50;transition:transform .3s}
        .sidebar-header{padding:24px 24px 20px;border-bottom:1px solid rgba(255,255,255,0.08)}
        .sidebar-logo{font-size:1.05rem;font-weight:800;color:var(--white);text-decoration:none}
        .sidebar-sub{font-size:.65rem;color:var(--g400);text-transform:uppercase;letter-spacing:2px;margin-top:4px}
        .sidebar-nav{flex:1;padding:16px 12px;display:flex;flex-direction:column;gap:2px}
        .nav-section{font-size:.65rem;font-weight:700;color:var(--g500);text-transform:uppercase;letter-spacing:1.5px;padding:16px 16px 6px}
        .nav-item{display:flex;align-items:center;gap:12px;padding:10px 16px;border-radius:10px;color:var(--g400);text-decoration:none;font-size:.875rem;font-weight:500;transition:all .2s;cursor:pointer;border:none;background:none;width:100%;text-align:left}
        .nav-item:hover{background:rgba(255,255,255,0.06);color:var(--white)}
        .nav-item.active{background:rgba(124,58,237,0.25);color:var(--white)}
        .nav-item svg{width:18px;height:18px;flex-shrink:0}
        .sidebar-footer{padding:16px 24px;border-top:1px solid rgba(255,255,255,0.08);font-size:.7rem;color:var(--g500)}
        .main{margin-left:260px;flex:1}
        .topbar{background:var(--white);border-bottom:1px solid var(--g200);padding:14px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:40}
        .topbar h1{font-size:1.15rem;font-weight:700;color:var(--primary-dark)}
        .topbar-right{display:flex;align-items:center;gap:16px}
        .avatar{width:34px;height:34px;border-radius:50%;background:var(--primary);color:var(--white);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem}
        .content{padding:28px 32px}
        .card{background:var(--white);border-radius:14px;box-shadow:0 1px 3px rgba(0,0,0,0.06),0 4px 12px rgba(0,0,0,0.03);overflow:hidden}
        .card-header{padding:18px 24px;border-bottom:1px solid var(--g100);display:flex;align-items:center;justify-content:space-between}
        .card-header h2{font-size:1rem;font-weight:700;color:var(--primary-dark)}
        .card-body{padding:24px}
        .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat-card{background:var(--white);border-radius:var(--r);padding:18px 20px;box-shadow:0 1px 3px rgba(0,0,0,0.06),0 4px 12px rgba(0,0,0,0.03)}
        .stat-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:10px}
        .stat-icon svg{width:20px;height:20px}
        .stat-label{font-size:.75rem;font-weight:600;color:var(--g500);text-transform:uppercase;letter-spacing:.5px}
        .stat-value{font-size:1.6rem;font-weight:800;color:var(--primary-dark);margin-top:2px}
        .stat-sub{font-size:.75rem;color:var(--g400);margin-top:2px}
        .form-group{margin-bottom:16px}
        .form-group label{display:block;font-size:.8rem;font-weight:600;color:var(--g700);margin-bottom:5px}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:9px 13px;border:1.5px solid var(--g200);border-radius:9px;font-size:.875rem;font-family:inherit;color:var(--g900);background:var(--white);transition:border-color .2s,box-shadow .2s}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #7c3aed1a}
        .form-group textarea{resize:vertical;min-height:70px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
        .form-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px}
        .form-row-4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:14px}
        .btn{display:inline-flex;align-items:center;gap:7px;padding:9px 18px;border-radius:9px;font-weight:600;font-size:.85rem;font-family:inherit;text-decoration:none;transition:all .2s;cursor:pointer;border:none}
        .btn-primary{background:var(--primary);color:var(--white)}.btn-primary:hover{filter:brightness(0.9)}
        .btn-success{background:var(--green);color:var(--white)}.btn-success:hover{filter:brightness(0.9)}
        .btn-danger{background:var(--red);color:var(--white)}.btn-danger:hover{filter:brightness(0.9)}
        .btn-outline{background:transparent;color:var(--g700);border:1.5px solid var(--g200)}.btn-outline:hover{border-color:var(--primary);color:var(--primary)}
        .btn-sm{padding:6px 12px;font-size:.78rem;border-radius:7px}
        .btn-group{display:flex;gap:8px}
        table{width:100%;border-collapse:collapse}
        th{text-align:left;padding:10px 16px;font-size:.72rem;font-weight:600;color:var(--g500);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid var(--g100);background:var(--g50)}
        td{padding:12px 16px;font-size:.875rem;border-bottom:1px solid var(--g100);vertical-align:middle}
        tr:hover td{background:var(--g50)}
        .badge{display:inline-block;padding:3px 10px;border-radius:50px;font-size:.72rem;font-weight:600;white-space:nowrap}
        .badge-intake{background:var(--blue-l);color:var(--blue)}
        .badge-active{background:var(--primary-light);color:var(--primary)}
        .badge-discovery{background:var(--orange-l);color:var(--orange)}
        .badge-litigation{background:var(--red-l);color:var(--red)}
        .badge-settlement{background:var(--green-l);color:var(--green)}
        .badge-closed{background:var(--g100);color:var(--g500)}
        .badge-pending{background:var(--orange-l);color:var(--orange)}
        .badge-sent{background:var(--green-l);color:var(--green)}
        .badge-scheduled{background:var(--primary-light);color:var(--primary)}
        .badge-urgent{background:var(--red-l);color:var(--red)}
        .badge-completed{background:var(--green-l);color:var(--green)}
        .page{display:none}.page.active{display:block}
        .modal-overlay{display:none;position:fixed;inset:0;z-index:100;background:rgba(0,0,0,0.4);backdrop-filter:blur(4px);align-items:center;justify-content:center;padding:24px}
        .modal-overlay.open{display:flex}
        .modal{background:var(--white);border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.12);width:100%;max-width:680px;max-height:90vh;overflow-y:auto}
        .modal-lg{max-width:780px}
        .modal-header{padding:18px 24px;border-bottom:1px solid var(--g100);display:flex;align-items:center;justify-content:space-between}
        .modal-header h2{font-size:1.05rem;font-weight:700;color:var(--primary-dark)}
        .modal-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--g400);line-height:1}
        .modal-body{padding:24px}
        .modal-footer{padding:14px 24px;border-top:1px solid var(--g100);display:flex;justify-content:flex-end;gap:10px}
        .deadline-card{display:flex;align-items:center;gap:14px;padding:14px 18px;background:var(--g50);border-radius:10px;border-left:4px solid var(--primary);margin-bottom:10px}
        .deadline-card.urgent{border-left-color:var(--red);background:var(--red-l)}
        .deadline-date{font-size:.8rem;font-weight:700;color:var(--primary-dark);min-width:80px}
        .deadline-info{flex:1}
        .deadline-info h4{font-size:.9rem;font-weight:600;color:var(--g800)}
        .deadline-info p{font-size:.8rem;color:var(--g500);margin-top:1px}
        .case-detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
        .case-detail-item label{font-size:.7rem;font-weight:600;color:var(--g400);text-transform:uppercase;letter-spacing:.5px}
        .case-detail-item p{font-size:.9rem;font-weight:500;color:var(--g800);margin-top:2px}
        .timeline-item{display:flex;gap:14px;padding:12px 0;border-bottom:1px solid var(--g100)}
        .timeline-dot{width:10px;height:10px;border-radius:50%;background:var(--primary);margin-top:5px;flex-shrink:0}
        .timeline-content h4{font-size:.85rem;font-weight:600;color:var(--g800)}
        .timeline-content p{font-size:.8rem;color:var(--g500);margin-top:1px}
        .ep-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid var(--primary-dark)}
        .ep-company h3{font-size:1.1rem;font-weight:800;color:var(--primary-dark)}
        .ep-company p{font-size:.8rem;color:var(--g500)}
        .ep-est-num{text-align:right}
        .ep-est-num h4{font-size:.85rem;font-weight:700;color:var(--primary-dark);text-transform:uppercase;letter-spacing:1px}
        .ep-est-num p{font-size:.85rem;color:var(--g500)}
        .ep-parties{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}
        .ep-parties h5{font-size:.7rem;font-weight:700;color:var(--g400);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
        .ep-parties p{font-size:.9rem;color:var(--g700)}
        .ep-table{width:100%;border-collapse:collapse;margin-bottom:16px}
        .ep-table th{background:var(--primary-dark);color:var(--white);padding:10px 14px;font-size:.72rem;text-transform:uppercase;letter-spacing:.5px;text-align:left}
        .ep-table td{padding:10px 14px;font-size:.875rem;border-bottom:1px solid var(--g100)}
        .ep-table .right{text-align:right}
        .ep-totals{text-align:right;margin-top:8px}
        .ep-totals .line{display:flex;justify-content:flex-end;gap:32px;padding:4px 0;font-size:.875rem;color:var(--g700)}
        .ep-totals .line.total{font-weight:800;font-size:1.05rem;color:var(--primary-dark);border-top:2px solid var(--g200);padding-top:8px;margin-top:4px}
        .estimate-preview{border:1.5px solid var(--g200);border-radius:var(--r);padding:28px;background:var(--white);margin-top:16px}
        .toast{position:fixed;bottom:32px;right:32px;z-index:200;background:var(--g900);color:var(--white);padding:14px 24px;border-radius:var(--r);font-size:.875rem;font-weight:500;box-shadow:0 8px 32px rgba(0,0,0,0.1);transform:translateY(100px);opacity:0;transition:all .3s}
        .toast.show{transform:translateY(0);opacity:1}.toast.success{background:var(--green)}
        .tabs{display:flex;gap:4px;margin-bottom:20px;border-bottom:2px solid var(--g100);padding-bottom:-2px}
        .tab{padding:8px 16px;font-size:.85rem;font-weight:600;color:var(--g400);cursor:pointer;border:none;background:none;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s;font-family:inherit}
        .tab.active{color:var(--primary);border-bottom-color:var(--primary)}
        .tab:hover{color:var(--primary-dark)}
        .search-bar{display:flex;gap:10px;margin-bottom:20px}
        .search-bar input{flex:1;padding:9px 14px;border:1.5px solid var(--g200);border-radius:9px;font-size:.875rem;font-family:inherit}
        .search-bar input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #7c3aed1a}
        .search-bar select{padding:9px 14px;border:1.5px solid var(--g200);border-radius:9px;font-size:.875rem;font-family:inherit;background:var(--white)}
        .sidebar-toggle{display:none;background:none;border:none;cursor:pointer;padding:4px}
        .sidebar-toggle svg{width:24px;height:24px;color:var(--primary-dark)}
        .sidebar-close{display:none;position:absolute;top:16px;right:16px;background:none;border:none;color:var(--g400);font-size:1.5rem;cursor:pointer}
        .info-box{background:var(--primary-light);border-radius:10px;padding:14px 18px;margin-top:12px}
        .info-box p{font-size:.8rem;color:var(--g700)}
        .info-box strong{color:var(--primary)}
        .sol-bar{height:6px;border-radius:3px;background:var(--g200);overflow:hidden;margin-top:4px}
        .sol-fill{height:100%;border-radius:3px;transition:width .5s}
        @media(max-width:1024px){.stats-row{grid-template-columns:repeat(2,1fr)}.form-row-3,.form-row-4{grid-template-columns:1fr 1fr}}
        @media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.sidebar-close,.sidebar-toggle{display:block}.main{margin-left:0}.content{padding:20px}.topbar{padding:14px 20px}.stats-row{grid-template-columns:1fr}.form-row,.form-row-3,.form-row-4{grid-template-columns:1fr}.case-detail-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<aside class="sidebar" id="sidebar">
    <button class="sidebar-close" onclick="document.getElementById('sidebar').classList.remove('open')">&times;</button>
    <div class="sidebar-header">
        <div class="sidebar-logo">Drake Injury Lawyers</div>
        <div class="sidebar-sub">Case Management</div>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-section">Overview</div>
        <button class="nav-item active" onclick="switchPage('dashboard',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>Dashboard</button>

        <div class="nav-section">Case Work</div>
        <button class="nav-item" onclick="switchPage('cases',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>Cases</button>
        <button class="nav-item" onclick="switchPage('intake',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>Client Intake</button>
        <button class="nav-item" onclick="switchPage('calendar',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Calendar & Deadlines</button>

        <div class="nav-section">Billing</div>
        <button class="nav-item" onclick="switchPage('billing',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>Billing & Invoices</button>

        <div class="nav-section">Admin</div>
        <button class="nav-item" onclick="switchPage('team',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Team</button>
    </nav>
    <div class="sidebar-footer">&copy; 2026 Drake Injury Lawyers<br>Powered by Williams Digital</div>
</aside>

<div class="main">
    <div class="topbar">
        <div style="display:flex;align-items:center;gap:12px">
            <button class="sidebar-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
            <h1 id="pageTitle">Dashboard</h1>
        </div>
        <div class="topbar-right">
            <span style="font-size:.8rem;color:var(--g500)">Managing Partner</span>
            <div class="avatar">DD</div>
        </div>
    </div>

    <div class="content">
        <!-- ========== DASHBOARD ========== -->
        <div class="page active" id="page-dashboard">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon" style="background:var(--blue-l)"><svg viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg></div>
                    <div class="stat-label">Active Cases</div><div class="stat-value" id="dActiveCases">12</div><div class="stat-sub">3 in litigation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:var(--orange-l)"><svg viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div>
                    <div class="stat-label">Upcoming Deadlines</div><div class="stat-value">5</div><div class="stat-sub">2 this week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:var(--green-l)"><svg viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div>
                    <div class="stat-label">Pending Invoices</div><div class="stat-value">$18,400</div><div class="stat-sub">4 outstanding</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background:var(--primary-light)"><svg viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg></div>
                    <div class="stat-label">New Intakes</div><div class="stat-value">3</div><div class="stat-sub">This month</div>
                </div>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
                <div class="card">
                    <div class="card-header"><h2>Upcoming Deadlines</h2></div>
                    <div class="card-body" id="dashDeadlines"></div>
                </div>
                <div class="card">
                    <div class="card-header"><h2>Recent Cases</h2></div>
                    <table><thead><tr><th>Case</th><th>Client</th><th>Status</th></tr></thead>
                    <tbody id="dashCases"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ========== CASES ========== -->
        <div class="page" id="page-cases">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <div class="search-bar" style="flex:1;max-width:500px">
                    <input type="text" id="caseSearch" placeholder="Search cases by name, number, or type..." oninput="renderCases()">
                    <select id="caseFilter" onchange="renderCases()">
                        <option value="">All Statuses</option>
                        <option value="Intake">Intake</option>
                        <option value="Active">Active</option>
                        <option value="Discovery">Discovery</option>
                        <option value="Litigation">Litigation</option>
                        <option value="Settlement">Settlement</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="openModal('caseModal')">+ New Case</button>
            </div>
            <div class="card">
                <table><thead><tr><th>Case #</th><th>Client</th><th>Type</th><th>Status</th><th>SOL Date</th><th>Assigned</th><th></th></tr></thead>
                <tbody id="caseTableBody"></tbody></table>
            </div>
            <div id="caseDetailArea" style="margin-top:24px;display:none"></div>
        </div>

        <!-- ========== CLIENT INTAKE ========== -->
        <div class="page" id="page-intake">
            <div class="card">
                <div class="card-header"><h2>New Client Intake Form</h2></div>
                <div class="card-body">
                    <h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin-bottom:14px">Client Information</h3>
                    <div class="form-row-3">
                        <div class="form-group"><label>First Name *</label><input type="text" id="intFirstName"></div>
                        <div class="form-group"><label>Last Name *</label><input type="text" id="intLastName"></div>
                        <div class="form-group"><label>Date of Birth</label><input type="date" id="intDOB"></div>
                    </div>
                    <div class="form-row-3">
                        <div class="form-group"><label>Phone *</label><input type="tel" id="intPhone" placeholder="(205) 555-1234"></div>
                        <div class="form-group"><label>Email *</label><input type="email" id="intEmail" placeholder="client@email.com"></div>
                        <div class="form-group"><label>Preferred Contact</label><select id="intPrefContact"><option>Phone</option><option>Email</option><option>Text</option></select></div>
                    </div>
                    <div class="form-group"><label>Address</label><input type="text" id="intAddress" placeholder="Street, City, State, ZIP"></div>

                    <h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 14px">Incident Details</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Type of Case *</label><select id="intCaseType">
                            <option>Auto Accident</option><option>Truck Accident</option><option>Motorcycle Accident</option>
                            <option>Slip & Fall</option><option>Workplace Injury</option><option>Medical Malpractice</option>
                            <option>Product Liability</option><option>Wrongful Death</option><option>Dog Bite</option><option>Other</option>
                        </select></div>
                        <div class="form-group"><label>Date of Incident *</label><input type="date" id="intIncidentDate"></div>
                    </div>
                    <div class="form-group"><label>Location of Incident</label><input type="text" id="intIncidentLoc" placeholder="Where did the incident occur?"></div>
                    <div class="form-group"><label>Description of Incident *</label><textarea id="intIncidentDesc" placeholder="Describe what happened in detail..."></textarea></div>

                    <h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 14px">Injuries & Treatment</h3>
                    <div class="form-group"><label>Injuries Sustained</label><textarea id="intInjuries" placeholder="List all injuries sustained..."></textarea></div>
                    <div class="form-row">
                        <div class="form-group"><label>Currently Under Treatment?</label><select id="intTreatment"><option>Yes</option><option>No</option><option>Completed Treatment</option></select></div>
                        <div class="form-group"><label>Treating Physician/Hospital</label><input type="text" id="intDoctor" placeholder="Doctor or hospital name"></div>
                    </div>

                    <h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 14px">Insurance & Other Parties</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Client's Insurance Carrier</label><input type="text" id="intClientIns" placeholder="Insurance company name"></div>
                        <div class="form-group"><label>Policy Number</label><input type="text" id="intPolicyNum" placeholder="Policy #"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>At-Fault Party (if known)</label><input type="text" id="intAtFault" placeholder="Name of at-fault party"></div>
                        <div class="form-group"><label>At-Fault Party's Insurance</label><input type="text" id="intAtFaultIns" placeholder="Their insurance company"></div>
                    </div>

                    <h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 14px">Additional Information</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Police Report Filed?</label><select id="intPoliceReport"><option>Yes</option><option>No</option><option>Unknown</option></select></div>
                        <div class="form-group"><label>Report Number</label><input type="text" id="intReportNum" placeholder="Report #"></div>
                    </div>
                    <div class="form-group"><label>How Did You Hear About Us?</label><select id="intReferral"><option>Google Search</option><option>Referral</option><option>Social Media</option><option>Billboard/Advertisement</option><option>Previous Client</option><option>Other</option></select></div>
                    <div class="form-group"><label>Additional Notes</label><textarea id="intNotes" placeholder="Any other relevant information..."></textarea></div>

                    <div class="info-box">
                        <p><strong>Statute of Limitations Reminder:</strong> Alabama personal injury claims generally have a <strong>2-year statute of limitations</strong> from the date of injury (Ala. Code &sect; 6-2-38). Wrongful death claims must be filed within 2 years. Medical malpractice has a 2-year SOL with a 6-month discovery rule.</p>
                    </div>

                    <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
                        <button class="btn btn-outline" onclick="clearIntake()">Clear Form</button>
                        <button class="btn btn-primary" onclick="submitIntake()">Create Case from Intake</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== CALENDAR & DEADLINES ========== -->
        <div class="page" id="page-calendar">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <div class="tabs">
                    <button class="tab active" onclick="switchCalTab('deadlines',this)">Deadlines & SOL</button>
                    <button class="tab" onclick="switchCalTab('events',this)">Events & Hearings</button>
                </div>
                <button class="btn btn-primary" onclick="openModal('eventModal')">+ Add Event</button>
            </div>

            <div id="calTab-deadlines">
                <div class="card">
                    <div class="card-header"><h2>Statute of Limitations Tracker</h2></div>
                    <table><thead><tr><th>Case</th><th>Client</th><th>Type</th><th>SOL Date</th><th>Days Left</th><th>Status</th></tr></thead>
                    <tbody id="solTableBody"></tbody></table>
                </div>
                <div class="card" style="margin-top:20px">
                    <div class="card-header"><h2>Upcoming Deadlines</h2></div>
                    <div class="card-body" id="deadlinesList"></div>
                </div>
            </div>

            <div id="calTab-events" style="display:none">
                <div class="card">
                    <div class="card-header"><h2>Scheduled Events</h2></div>
                    <table><thead><tr><th>Date</th><th>Time</th><th>Event</th><th>Case</th><th>Location</th><th>Attorney</th><th></th></tr></thead>
                    <tbody id="eventsTableBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ========== BILLING ========== -->
        <div class="page" id="page-billing">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                <div class="tabs">
                    <button class="tab active" onclick="switchBillTab('invoices',this)">Invoices</button>
                    <button class="tab" onclick="switchBillTab('agreements',this)">Fee Agreements</button>
                </div>
                <button class="btn btn-primary" onclick="openModal('invoiceModal')">+ New Invoice</button>
            </div>

            <div id="billTab-invoices">
                <div class="stats-row" style="grid-template-columns:repeat(3,1fr)">
                    <div class="stat-card"><div class="stat-label">Outstanding</div><div class="stat-value">$18,400</div></div>
                    <div class="stat-card"><div class="stat-label">Collected This Month</div><div class="stat-value">$34,200</div></div>
                    <div class="stat-card"><div class="stat-label">Total Billed YTD</div><div class="stat-value">$127,800</div></div>
                </div>
                <div class="card">
                    <table><thead><tr><th>#</th><th>Client</th><th>Case</th><th>Description</th><th>Amount</th><th>Date</th><th>Status</th><th></th></tr></thead>
                    <tbody id="invoiceTableBody"></tbody></table>
                </div>
                <div id="invoicePreviewArea" style="margin-top:24px;display:none"></div>
            </div>

            <div id="billTab-agreements" style="display:none">
                <div class="card">
                    <div class="card-header"><h2>Fee Agreements</h2></div>
                    <table><thead><tr><th>Case</th><th>Client</th><th>Type</th><th>Rate/Percentage</th><th>Retainer</th><th>Status</th></tr></thead>
                    <tbody id="feeAgreementsBody"></tbody></table>
                </div>
            </div>
        </div>

        <!-- ========== TEAM ========== -->
        <div class="page" id="page-team">
            <div class="card">
                <div class="card-header"><h2>Team Members</h2></div>
                <table><thead><tr><th>Name</th><th>Role</th><th>Bar #</th><th>Email</th><th>Phone</th><th>Active Cases</th><th>Status</th></tr></thead>
                <tbody>
                    <tr><td style="font-weight:600">David Drake</td><td>Managing Partner</td><td>ASB-4521</td><td>david@drakeinjurylawyers.com</td><td>(205) 970-0801</td><td>8</td><td><span class="badge badge-completed">Active</span></td></tr>
                    <tr><td style="font-weight:600">Sarah Mitchell</td><td>Senior Associate</td><td>ASB-6834</td><td>sarah@drakeinjurylawyers.com</td><td>(205) 970-0802</td><td>6</td><td><span class="badge badge-completed">Active</span></td></tr>
                    <tr><td style="font-weight:600">James Walker</td><td>Associate Attorney</td><td>ASB-9127</td><td>james@drakeinjurylawyers.com</td><td>(205) 970-0803</td><td>5</td><td><span class="badge badge-completed">Active</span></td></tr>
                    <tr><td style="font-weight:600">Maria Gonzalez</td><td>Paralegal</td><td>--</td><td>maria@drakeinjurylawyers.com</td><td>(205) 970-0804</td><td>10</td><td><span class="badge badge-completed">Active</span></td></tr>
                    <tr><td style="font-weight:600">Kevin Thompson</td><td>Legal Assistant</td><td>--</td><td>kevin@drakeinjurylawyers.com</td><td>(205) 970-0805</td><td>7</td><td><span class="badge badge-completed">Active</span></td></tr>
                    <tr><td style="font-weight:600">Lisa Chen</td><td>Office Manager</td><td>--</td><td>lisa@drakeinjurylawyers.com</td><td>(205) 970-0806</td><td>--</td><td><span class="badge badge-completed">Active</span></td></tr>
                </tbody></table>
            </div>
        </div>
    </div>
</div>

<!-- NEW CASE MODAL -->
<div class="modal-overlay" id="caseModal"><div class="modal modal-lg">
    <div class="modal-header"><h2>Open New Case</h2><button class="modal-close" onclick="closeModal('caseModal')">&times;</button></div>
    <div class="modal-body">
        <div class="form-row"><div class="form-group"><label>Client Name *</label><input type="text" id="ncClient"></div><div class="form-group"><label>Client Email</label><input type="email" id="ncEmail"></div></div>
        <div class="form-row"><div class="form-group"><label>Client Phone</label><input type="tel" id="ncPhone"></div><div class="form-group"><label>Case Type *</label><select id="ncType"><option>Auto Accident</option><option>Truck Accident</option><option>Motorcycle Accident</option><option>Slip & Fall</option><option>Workplace Injury</option><option>Medical Malpractice</option><option>Product Liability</option><option>Wrongful Death</option><option>Dog Bite</option><option>Other</option></select></div></div>
        <div class="form-row"><div class="form-group"><label>Date of Incident</label><input type="date" id="ncIncDate"></div><div class="form-group"><label>Statute of Limitations Date</label><input type="date" id="ncSOL"></div></div>
        <div class="form-row"><div class="form-group"><label>Assign Attorney *</label><select id="ncAttorney"><option value="david@drakeinjurylawyers.com">David Drake</option><option value="sarah@drakeinjurylawyers.com">Sarah Mitchell</option><option value="james@drakeinjurylawyers.com">James Walker</option></select></div><div class="form-group"><label>Fee Type</label><select id="ncFeeType"><option>Contingency (33%)</option><option>Contingency (40%)</option><option>Hourly</option><option>Flat Fee</option><option>Hybrid</option></select></div></div>
        <div class="form-group"><label>Case Description</label><textarea id="ncDesc" placeholder="Brief summary of the case..."></textarea></div>
        <div class="form-group"><label>Opposing Party</label><input type="text" id="ncOpposing" placeholder="Defendant name"></div>
        <div class="form-group"><label>Opposing Insurance</label><input type="text" id="ncOpposingIns" placeholder="Insurance company"></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('caseModal')">Cancel</button><button class="btn btn-primary" onclick="createCase()">Open Case</button></div>
</div></div>

<!-- EVENT MODAL -->
<div class="modal-overlay" id="eventModal"><div class="modal">
    <div class="modal-header"><h2>Schedule Event</h2><button class="modal-close" onclick="closeModal('eventModal')">&times;</button></div>
    <div class="modal-body">
        <div class="form-row"><div class="form-group"><label>Event Type *</label><select id="evType"><option>Court Hearing</option><option>Deposition</option><option>Mediation</option><option>Client Meeting</option><option>IME Appointment</option><option>Filing Deadline</option><option>Discovery Deadline</option><option>Demand Letter Deadline</option><option>Settlement Conference</option><option>Trial Date</option></select></div><div class="form-group"><label>Related Case</label><select id="evCase"></select></div></div>
        <div class="form-row"><div class="form-group"><label>Date *</label><input type="date" id="evDate"></div><div class="form-group"><label>Time</label><input type="time" id="evTime" value="09:00"></div></div>
        <div class="form-group"><label>Location / Address</label><input type="text" id="evAddr" placeholder="Courthouse, office address, etc."></div>
        <div class="form-row"><div class="form-group"><label>Assign Attorney</label><select id="evAttorney"><option value="david@drakeinjurylawyers.com">David Drake</option><option value="sarah@drakeinjurylawyers.com">Sarah Mitchell</option><option value="james@drakeinjurylawyers.com">James Walker</option></select></div><div class="form-group"><label>Send Notification?</label><select id="evNotify"><option value="yes">Yes - Email with directions</option><option value="no">No</option></select></div></div>
        <div class="form-group"><label>Notes</label><textarea id="evNotes" placeholder="Additional details..."></textarea></div>
        <div class="info-box"><p><strong>Directions:</strong> If a location is provided and notification is enabled, the assigned attorney will receive an email with a Google Maps link for turn-by-turn directions from their current location.</p></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('eventModal')">Cancel</button><button class="btn btn-success" onclick="createEvent()">Schedule Event</button></div>
</div></div>

<!-- INVOICE MODAL -->
<div class="modal-overlay" id="invoiceModal"><div class="modal modal-lg">
    <div class="modal-header"><h2>Create Invoice</h2><button class="modal-close" onclick="closeModal('invoiceModal')">&times;</button></div>
    <div class="modal-body">
        <div class="form-row"><div class="form-group"><label>Client Name *</label><input type="text" id="invClient"></div><div class="form-group"><label>Client Email *</label><input type="email" id="invEmail"></div></div>
        <div class="form-row"><div class="form-group"><label>Related Case</label><select id="invCase"></select></div><div class="form-group"><label>Client Address</label><input type="text" id="invAddr" placeholder="Billing address"></div></div>
        <div id="invLineItems"><div class="form-row-3 li-row"><div class="form-group"><label>Description</label><input type="text" placeholder="Legal service rendered"></div><div class="form-group"><label>Hours/Qty</label><input type="number" value="1" min="0.25" step="0.25"></div><div class="form-group"><label>Rate ($)</label><input type="number" placeholder="0.00" step="0.01"></div></div></div>
        <button class="btn btn-outline btn-sm" onclick="addInvLine()" style="margin-bottom:16px">+ Add Line Item</button>
        <div class="form-group"><label>Payment Terms</label><select id="invTerms"><option>Due Upon Receipt</option><option>Net 15</option><option>Net 30</option><option>Net 60</option></select></div>
        <div class="form-group"><label>Notes</label><textarea id="invNotes" placeholder="Additional notes or payment instructions..."></textarea></div>
    </div>
    <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal('invoiceModal')">Cancel</button><button class="btn btn-primary" onclick="createInvoice()">Create Invoice</button></div>
</div></div>

<div class="toast" id="toast"></div>

<script>
const BIZ="Drake Injury Lawyers",ADDR="2001 Park Place N, Suite 450, Birmingham, AL 35203",PHONE="(205) 970-0800",EMAIL="info@drakeinjurylawyers.com";
const TITLES={dashboard:'Dashboard',cases:'Cases',intake:'Client Intake',calendar:'Calendar & Deadlines',billing:'Billing & Invoices',team:'Team'};
const ATTORNEYS=['David Drake','Sarah Mitchell','James Walker'];

// ========== NAV ==========
function switchPage(p,el){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.getElementById('page-'+p).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));if(el)el.classList.add('active');document.getElementById('pageTitle').textContent=TITLES[p]||p;document.getElementById('sidebar').classList.remove('open')}
function openModal(id){document.getElementById(id).classList.add('open');populateCaseDropdowns()}
function closeModal(id){document.getElementById(id).classList.remove('open')}
function showToast(m,t){const e=document.getElementById('toast');e.textContent=m;e.className='toast show'+(t?' '+t:'');setTimeout(()=>e.className='toast',3500)}

// ========== DATA ==========
const cases=[
    {num:'DI-2025-001',client:'Robert Johnson',email:'rjohnson@email.com',phone:'(205) 555-1234',type:'Auto Accident',status:'Litigation',solDate:'2027-03-15',incDate:'2025-03-15',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',opposing:'John Smith',opposingIns:'State Farm',feeType:'Contingency (33%)',desc:'Rear-end collision at Highway 280 and Overton Rd. Client sustained whiplash and herniated disc. Liability clear - defendant cited by police.'},
    {num:'DI-2025-002',client:'Angela Martinez',email:'amartinez@email.com',phone:'(205) 555-2345',type:'Slip & Fall',status:'Discovery',solDate:'2027-06-20',incDate:'2025-06-20',attorney:'Sarah Mitchell',attEmail:'sarah@drakeinjurylawyers.com',opposing:'Walmart Inc.',opposingIns:'Walmart Claims',feeType:'Contingency (33%)',desc:'Client slipped on wet floor with no warning signs at Walmart on US-31. Fractured wrist and knee injury.'},
    {num:'DI-2025-003',client:'Marcus Williams',email:'mwilliams@email.com',phone:'(205) 555-3456',type:'Truck Accident',status:'Active',solDate:'2027-08-10',incDate:'2025-08-10',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',opposing:'ABC Trucking LLC',opposingIns:'Great West Casualty',feeType:'Contingency (40%)',desc:'18-wheeler sideswipe on I-65. Multiple fractures, surgery required. FMCSA violations by carrier.'},
    {num:'DI-2025-004',client:'Patricia Davis',email:'pdavis@email.com',phone:'(205) 555-4567',type:'Medical Malpractice',status:'Active',solDate:'2027-11-02',incDate:'2025-11-02',attorney:'James Walker',attEmail:'james@drakeinjurylawyers.com',opposing:'Dr. William Hayes',opposingIns:'Medical Protective',feeType:'Contingency (40%)',desc:'Misdiagnosis of appendicitis leading to rupture and sepsis. 2-week ICU stay.'},
    {num:'DI-2026-005',client:'Thomas Brown',email:'tbrown@email.com',phone:'(205) 555-5678',type:'Workplace Injury',status:'Intake',solDate:'2028-01-05',incDate:'2026-01-05',attorney:'Sarah Mitchell',attEmail:'sarah@drakeinjurylawyers.com',opposing:'Birmingham Steel Works',opposingIns:'Liberty Mutual',feeType:'Contingency (33%)',desc:'Scaffolding collapse at construction site. Broken leg and back injury. OSHA violations documented.'},
    {num:'DI-2026-006',client:'Jennifer Lee',email:'jlee@email.com',phone:'(205) 555-6789',type:'Auto Accident',status:'Settlement',solDate:'2028-01-20',incDate:'2026-01-20',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',opposing:'Mike Turner',opposingIns:'Allstate',feeType:'Contingency (33%)',desc:'T-bone collision at intersection. Soft tissue injuries. Demand letter sent, negotiating settlement.'},
    {num:'DI-2024-007',client:'William Carter',email:'wcarter@email.com',phone:'(205) 555-7890',type:'Auto Accident',status:'Closed',solDate:'2026-04-12',incDate:'2024-04-12',attorney:'Sarah Mitchell',attEmail:'sarah@drakeinjurylawyers.com',opposing:'Lisa Wong',opposingIns:'GEICO',feeType:'Contingency (33%)',desc:'Settled for $85,000. Fender bender with soft tissue injuries.'},
];

const events=[
    {date:'2026-02-03',time:'09:30',type:'Court Hearing',caseNum:'DI-2025-001',addr:'Jefferson County Courthouse, 716 N 21st St, Birmingham, AL',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',notes:'Motion to compel discovery responses'},
    {date:'2026-02-05',time:'14:00',type:'Deposition',caseNum:'DI-2025-002',addr:'2001 Park Place N, Suite 450, Birmingham, AL',attorney:'Sarah Mitchell',attEmail:'sarah@drakeinjurylawyers.com',notes:'Deposition of store manager'},
    {date:'2026-02-10',time:'10:00',type:'Mediation',caseNum:'DI-2026-006',addr:'JAMS Birmingham, 420 20th St N, Birmingham, AL',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',notes:'Full-day mediation session'},
    {date:'2026-02-12',time:'11:00',type:'Client Meeting',caseNum:'DI-2025-003',addr:'Drake Injury Lawyers Office',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',notes:'Review medical records and discuss litigation strategy'},
    {date:'2026-02-14',time:'09:00',type:'IME Appointment',caseNum:'DI-2025-004',addr:'Alabama Orthopedic Clinic, 2700 Hwy 280, Birmingham, AL',attorney:'James Walker',attEmail:'james@drakeinjurylawyers.com',notes:'Independent medical examination - Dr. Reynolds'},
    {date:'2026-01-31',time:'23:59',type:'Filing Deadline',caseNum:'DI-2025-001',addr:'Jefferson County Courthouse',attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',notes:'Deadline to file amended complaint'},
];

const deadlines=[
    {date:'2026-01-31',label:'File Amended Complaint',caseNum:'DI-2025-001',client:'Robert Johnson',urgent:true},
    {date:'2026-02-05',label:'Respond to Interrogatories',caseNum:'DI-2025-002',client:'Angela Martinez',urgent:true},
    {date:'2026-02-15',label:'Expert Witness Designation',caseNum:'DI-2025-003',client:'Marcus Williams',urgent:false},
    {date:'2026-02-28',label:'Medical Records Request Follow-up',caseNum:'DI-2025-004',client:'Patricia Davis',urgent:false},
    {date:'2026-03-10',label:'Demand Letter Deadline',caseNum:'DI-2026-005',client:'Thomas Brown',urgent:false},
];

const invoices=[
    {num:'INV-001',client:'Robert Johnson',email:'rjohnson@email.com',caseNum:'DI-2025-001',items:[{desc:'Court filing fees',qty:1,price:435},{desc:'Expert witness consultation (Dr. Patel)',qty:3,price:350},{desc:'Medical records procurement',qty:1,price:125}],notes:'Due upon receipt.',date:'Jan 15, 2026',status:'Pending'},
    {num:'INV-002',client:'Angela Martinez',email:'amartinez@email.com',caseNum:'DI-2025-002',items:[{desc:'Deposition transcription',qty:1,price:800},{desc:'Process server fees',qty:2,price:75},{desc:'Court reporter',qty:4,price:300}],notes:'Net 30.',date:'Jan 22, 2026',status:'Sent'},
    {num:'INV-003',client:'William Carter',email:'wcarter@email.com',caseNum:'DI-2024-007',items:[{desc:'Contingency fee - 33% of $85,000 settlement',qty:1,price:28050}],notes:'Fee collected from settlement proceeds.',date:'Dec 10, 2025',status:'Paid'},
];

const feeAgreements=[
    {caseNum:'DI-2025-001',client:'Robert Johnson',type:'Contingency',rate:'33%',retainer:'$0',status:'Active'},
    {caseNum:'DI-2025-002',client:'Angela Martinez',type:'Contingency',rate:'33%',retainer:'$0',status:'Active'},
    {caseNum:'DI-2025-003',client:'Marcus Williams',type:'Contingency',rate:'40%',retainer:'$0',status:'Active'},
    {caseNum:'DI-2025-004',client:'Patricia Davis',type:'Contingency',rate:'40%',retainer:'$500 costs advance',status:'Active'},
    {caseNum:'DI-2026-005',client:'Thomas Brown',type:'Contingency',rate:'33%',retainer:'$0',status:'Pending Signature'},
    {caseNum:'DI-2026-006',client:'Jennifer Lee',type:'Contingency',rate:'33%',retainer:'$0',status:'Active'},
];

let invCount=3,caseCount=7;

// ========== HELPERS ==========
function fmtDate(d){return new Date(d+'T00:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}
function fmtTime(t){let[h,m]=t.split(':');h=+h;const ap=h>=12?'PM':'AM';h=h%12||12;return h+':'+m+' '+ap}
function daysUntil(d){return Math.ceil((new Date(d+'T00:00:00')-new Date())/(1000*60*60*24))}
function statusBadge(s){const m={Intake:'intake',Active:'active',Discovery:'discovery',Litigation:'litigation',Settlement:'settlement',Closed:'closed',Pending:'pending',Sent:'sent',Paid:'completed'};return`<span class="badge badge-${m[s]||'active'}">${s}</span>`}
function populateCaseDropdowns(){['evCase','invCase'].forEach(id=>{const el=document.getElementById(id);if(!el)return;const v=el.value;el.innerHTML='<option value="">-- Select Case --</option>'+cases.filter(c=>c.status!=='Closed').map(c=>`<option value="${c.num}">${c.num} - ${c.client}</option>`).join('');el.value=v})}

// ========== RENDER FUNCTIONS ==========
function renderDashboard(){
    const active=cases.filter(c=>!['Closed'].includes(c.status));
    document.getElementById('dActiveCases').textContent=active.length;
    // Recent cases
    document.getElementById('dashCases').innerHTML=cases.slice(0,5).map(c=>`<tr><td style="font-weight:600">${c.num}</td><td>${c.client}</td><td>${statusBadge(c.status)}</td></tr>`).join('');
    // Upcoming deadlines
    const dl=deadlines.sort((a,b)=>a.date.localeCompare(b.date)).slice(0,4);
    document.getElementById('dashDeadlines').innerHTML=dl.map(d=>{const days=daysUntil(d.date);return`<div class="deadline-card${d.urgent?' urgent':''}"><div class="deadline-date">${fmtDate(d.date)}</div><div class="deadline-info"><h4>${d.label}</h4><p>${d.caseNum} &mdash; ${d.client} &mdash; ${days<=0?'<strong style="color:var(--red)">OVERDUE</strong>':days+' days left'}</p></div></div>`}).join('')
}

function renderCases(){
    const q=(document.getElementById('caseSearch').value||'').toLowerCase();
    const f=document.getElementById('caseFilter').value;
    const filtered=cases.filter(c=>{
        if(f&&c.status!==f)return false;
        if(q&&!(c.client.toLowerCase().includes(q)||c.num.toLowerCase().includes(q)||c.type.toLowerCase().includes(q)))return false;
        return true;
    });
    const today=new Date();
    document.getElementById('caseTableBody').innerHTML=filtered.map(c=>{
        const days=daysUntil(c.solDate);
        const solClass=days<=90?'color:var(--red);font-weight:700':days<=180?'color:var(--orange);font-weight:600':'';
        return`<tr><td style="font-weight:600">${c.num}</td><td>${c.client}<br><span style="font-size:.78rem;color:var(--g400)">${c.email}</span></td><td>${c.type}</td><td>${statusBadge(c.status)}</td><td style="${solClass}">${fmtDate(c.solDate)}${days<=90?' ('+days+'d)':''}</td><td>${c.attorney}</td><td><button class="btn btn-outline btn-sm" onclick="viewCase('${c.num}')">View</button></td></tr>`
    }).join('');
}

function viewCase(num){
    const c=cases.find(x=>x.num===num);if(!c)return;
    const days=daysUntil(c.solDate);
    const pct=Math.max(0,Math.min(100,100-((days/730)*100)));
    const barColor=days<=90?'var(--red)':days<=180?'var(--orange)':'var(--green)';
    const caseEvents=events.filter(e=>e.caseNum===num);
    const caseInvoices=invoices.filter(i=>i.caseNum===num);
    const area=document.getElementById('caseDetailArea');
    area.style.display='block';
    area.innerHTML=`<div class="card"><div class="card-header"><h2>Case: ${c.num}</h2><div class="btn-group"><button class="btn btn-outline btn-sm" onclick="emailClient('${c.email}','${c.client}','${c.num}')">Email Client</button><button class="btn btn-outline btn-sm" onclick="document.getElementById('caseDetailArea').style.display='none'">Close</button></div></div><div class="card-body">
    <div class="case-detail-grid">
        <div class="case-detail-item"><label>Client</label><p>${c.client}</p></div>
        <div class="case-detail-item"><label>Case Type</label><p>${c.type}</p></div>
        <div class="case-detail-item"><label>Status</label><p>${statusBadge(c.status)}</p></div>
        <div class="case-detail-item"><label>Assigned Attorney</label><p>${c.attorney}</p></div>
        <div class="case-detail-item"><label>Date of Incident</label><p>${fmtDate(c.incDate)}</p></div>
        <div class="case-detail-item"><label>Statute of Limitations</label><p>${fmtDate(c.solDate)} <span style="font-size:.8rem;color:${days<=90?'var(--red)':'var(--g500)'}"> (${days} days remaining)</span></p><div class="sol-bar"><div class="sol-fill" style="width:${pct}%;background:${barColor}"></div></div></div>
        <div class="case-detail-item"><label>Fee Agreement</label><p>${c.feeType}</p></div>
        <div class="case-detail-item"><label>Opposing Party</label><p>${c.opposing||'N/A'}</p></div>
        <div class="case-detail-item"><label>Opposing Insurance</label><p>${c.opposingIns||'N/A'}</p></div>
        <div class="case-detail-item"><label>Contact</label><p>${c.phone} &bull; ${c.email}</p></div>
    </div>
    <div style="margin-bottom:16px"><label style="font-size:.7rem;font-weight:600;color:var(--g400);text-transform:uppercase;letter-spacing:.5px">Case Summary</label><p style="font-size:.875rem;color:var(--g700);margin-top:4px;line-height:1.6">${c.desc}</p></div>
    ${caseEvents.length?`<h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 10px">Upcoming Events</h3>${caseEvents.map(e=>`<div class="deadline-card"><div class="deadline-date">${fmtDate(e.date)}<br><span style="font-size:.75rem;font-weight:400">${fmtTime(e.time)}</span></div><div class="deadline-info"><h4>${e.type}</h4><p>${e.addr} &mdash; ${e.attorney}</p></div></div>`).join('')}`:''}
    ${caseInvoices.length?`<h3 style="font-size:.9rem;font-weight:700;color:var(--primary-dark);margin:20px 0 10px">Invoices</h3><table><thead><tr><th>#</th><th>Amount</th><th>Date</th><th>Status</th></tr></thead><tbody>${caseInvoices.map(i=>{const tot=i.items.reduce((s,x)=>s+x.qty*x.price,0);return`<tr><td>${i.num}</td><td>$${tot.toLocaleString()}</td><td>${i.date}</td><td>${statusBadge(i.status)}</td></tr>`}).join('')}</tbody></table>`:''}
    </div></div>`;
    area.scrollIntoView({behavior:'smooth'});
}

function emailClient(email,name,caseNum){
    const subj=encodeURIComponent('Case Update: '+caseNum+' - Drake Injury Lawyers');
    const body=encodeURIComponent('Dear '+name.split(' ')[0]+',\n\nI wanted to provide you with an update regarding your case ('+caseNum+').\n\n[Update details here]\n\nPlease don\'t hesitate to call us at '+PHONE+' if you have any questions.\n\nBest regards,\nDrake Injury Lawyers\n'+PHONE+'\n'+EMAIL);
    window.open('mailto:'+email+'?subject='+subj+'&body='+body,'_self');
}

function renderSOL(){
    const active=cases.filter(c=>c.status!=='Closed').sort((a,b)=>a.solDate.localeCompare(b.solDate));
    document.getElementById('solTableBody').innerHTML=active.map(c=>{
        const days=daysUntil(c.solDate);
        const pct=Math.max(0,Math.min(100,100-((days/730)*100)));
        const barColor=days<=90?'var(--red)':days<=180?'var(--orange)':'var(--green)';
        const urgency=days<=90?'<span class="badge badge-urgent">URGENT</span>':days<=180?'<span class="badge badge-pending">Approaching</span>':'<span class="badge badge-completed">OK</span>';
        return`<tr><td style="font-weight:600">${c.num}</td><td>${c.client}</td><td>${c.type}</td><td>${fmtDate(c.solDate)}</td><td><strong style="color:${days<=90?'var(--red)':days<=180?'var(--orange)':'var(--g800)'}">${days} days</strong><div class="sol-bar" style="width:120px"><div class="sol-fill" style="width:${pct}%;background:${barColor}"></div></div></td><td>${urgency}</td></tr>`;
    }).join('');
}

function renderDeadlines(){
    const sorted=deadlines.sort((a,b)=>a.date.localeCompare(b.date));
    document.getElementById('deadlinesList').innerHTML=sorted.map(d=>{const days=daysUntil(d.date);return`<div class="deadline-card${d.urgent||days<=3?' urgent':''}"><div class="deadline-date">${fmtDate(d.date)}</div><div class="deadline-info"><h4>${d.label}</h4><p>${d.caseNum} &mdash; ${d.client} &mdash; ${days<=0?'<strong style="color:var(--red)">OVERDUE</strong>':days+' days left'}</p></div></div>`}).join('');
}

function renderEvents(){
    const sorted=events.sort((a,b)=>a.date.localeCompare(b.date)||a.time.localeCompare(b.time));
    document.getElementById('eventsTableBody').innerHTML=sorted.map((e,i)=>{
        const url='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(e.addr);
        return`<tr><td>${fmtDate(e.date)}</td><td>${fmtTime(e.time)}</td><td style="font-weight:600">${e.type}</td><td>${e.caseNum}</td><td><a href="${url}" target="_blank" style="color:var(--primary);text-decoration:none">${e.addr}</a></td><td>${e.attorney}</td><td><button class="btn btn-outline btn-sm" onclick="sendEventEmail(${i})">Send Reminder</button></td></tr>`;
    }).join('');
}

function sendEventEmail(i){
    const e=events[i];if(!e)return;
    const url='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(e.addr);
    const d=fmtDate(e.date),t=fmtTime(e.time);
    const subj=encodeURIComponent(e.type+' - '+e.caseNum+' - '+d);
    const body=encodeURIComponent('Hi '+e.attorney.split(' ')[0]+',\n\nReminder for upcoming event:\n\nEvent: '+e.type+'\nCase: '+e.caseNum+'\nDate: '+d+'\nTime: '+t+'\nLocation: '+e.addr+'\n\nGoogle Maps Directions:\n'+url+'\n\n'+(e.notes?'Notes: '+e.notes+'\n\n':'')+'Thank you,\n'+BIZ+'\n'+PHONE);
    window.open('mailto:'+e.attEmail+'?subject='+subj+'&body='+body,'_self');
    showToast('Reminder email opened for '+e.attorney,'success');
}

function renderInvoices(){
    document.getElementById('invoiceTableBody').innerHTML=invoices.map((inv,i)=>{
        const tot=inv.items.reduce((s,x)=>s+x.qty*x.price,0);
        return`<tr><td style="font-weight:600">#${inv.num}</td><td>${inv.client}<br><span style="font-size:.78rem;color:var(--g400)">${inv.email}</span></td><td>${inv.caseNum||'--'}</td><td>${inv.items[0]?.desc||'--'}</td><td>$${tot.toLocaleString('en-US',{minimumFractionDigits:2})}</td><td>${inv.date}</td><td>${statusBadge(inv.status)}</td><td><div class="btn-group"><button class="btn btn-outline btn-sm" onclick="previewInvoice(${i})">View</button><button class="btn btn-outline btn-sm" onclick="emailInvoice(${i})">Email</button></div></td></tr>`;
    }).join('');
}

function previewInvoice(i){
    const inv=invoices[i];if(!inv)return;
    const sub=inv.items.reduce((s,x)=>s+x.qty*x.price,0);
    const area=document.getElementById('invoicePreviewArea');
    area.style.display='block';
    area.innerHTML=`<div class="card"><div class="card-header"><h2>Invoice Preview</h2><div class="btn-group"><button class="btn btn-primary btn-sm" onclick="emailInvoice(${i})">Email to Client</button><button class="btn btn-outline btn-sm" onclick="document.getElementById('invoicePreviewArea').style.display='none'">Close</button></div></div><div class="card-body"><div class="estimate-preview">
    <div class="ep-header"><div class="ep-company"><h3>${BIZ}</h3><p>${ADDR}</p><p>${PHONE} &bull; ${EMAIL}</p></div><div class="ep-est-num"><h4>Invoice #${inv.num}</h4><p>${inv.date}</p><p>${inv.caseNum?'Case: '+inv.caseNum:''}</p></div></div>
    <div class="ep-parties"><div><h5>From</h5><p><strong>${BIZ}</strong><br>${ADDR}</p></div><div><h5>Bill To</h5><p><strong>${inv.client}</strong><br>${inv.email}</p></div></div>
    <table class="ep-table"><thead><tr><th>Description</th><th>Qty/Hours</th><th class="right">Rate</th><th class="right">Amount</th></tr></thead><tbody>${inv.items.map(x=>`<tr><td>${x.desc}</td><td>${x.qty}</td><td class="right">$${x.price.toFixed(2)}</td><td class="right">$${(x.qty*x.price).toFixed(2)}</td></tr>`).join('')}</tbody></table>
    <div class="ep-totals"><div class="line total"><span>Total Due</span><span>$${sub.toLocaleString('en-US',{minimumFractionDigits:2})}</span></div></div>
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--g100)"><p style="font-size:.8rem;color:var(--g400)">Terms: ${inv.notes||'Due upon receipt.'}</p></div>
    </div></div></div>`;
    area.scrollIntoView({behavior:'smooth'});
}

function emailInvoice(i){
    const inv=invoices[i];if(!inv)return;
    const tot=inv.items.reduce((s,x)=>s+x.qty*x.price,0);
    const subj=encodeURIComponent('Invoice #'+inv.num+' from Drake Injury Lawyers');
    const body=encodeURIComponent('Dear '+inv.client.split(' ')[0]+',\n\nPlease find below your invoice details:\n\nInvoice #: '+inv.num+'\n'+(inv.caseNum?'Case: '+inv.caseNum+'\n':'')+'Amount Due: $'+tot.toLocaleString('en-US',{minimumFractionDigits:2})+'\nTerms: '+(inv.notes||'Due upon receipt.')+'\n\nItems:\n'+inv.items.map(x=>'- '+x.desc+': $'+(x.qty*x.price).toFixed(2)).join('\n')+'\n\nPlease contact us at '+PHONE+' if you have any questions.\n\nThank you,\n'+BIZ+'\n'+ADDR+'\n'+PHONE);
    window.open('mailto:'+inv.email+'?subject='+subj+'&body='+body,'_self');
    showToast('Invoice email opened for '+inv.client,'success');
}

function renderFeeAgreements(){
    document.getElementById('feeAgreementsBody').innerHTML=feeAgreements.map(f=>`<tr><td style="font-weight:600">${f.caseNum}</td><td>${f.client}</td><td>${f.type}</td><td>${f.rate}</td><td>${f.retainer}</td><td>${statusBadge(f.status==='Pending Signature'?'Pending':f.status==='Active'?'Sent':'Closed')}</td></tr>`).join('');
}

// ========== ACTIONS ==========
function createCase(){
    const client=document.getElementById('ncClient').value.trim();
    const email=document.getElementById('ncEmail').value.trim();
    if(!client){showToast('Client name is required.');return}
    caseCount++;
    const num='DI-2026-'+String(caseCount).padStart(3,'0');
    const attSel=document.getElementById('ncAttorney');
    cases.unshift({num,client,email:email||'',phone:document.getElementById('ncPhone').value.trim(),type:document.getElementById('ncType').value,status:'Intake',solDate:document.getElementById('ncSOL').value||'',incDate:document.getElementById('ncIncDate').value||'',attorney:attSel.options[attSel.selectedIndex].text,attEmail:attSel.value,opposing:document.getElementById('ncOpposing').value.trim(),opposingIns:document.getElementById('ncOpposingIns').value.trim(),feeType:document.getElementById('ncFeeType').value,desc:document.getElementById('ncDesc').value.trim()});
    closeModal('caseModal');renderCases();renderDashboard();
    showToast('Case '+num+' opened!','success');
}

function createEvent(){
    const type=document.getElementById('evType').value;
    const date=document.getElementById('evDate').value;
    const time=document.getElementById('evTime').value;
    const addr=document.getElementById('evAddr').value.trim();
    if(!date){showToast('Date is required.');return}
    const attSel=document.getElementById('evAttorney');
    const ev={date,time,type,caseNum:document.getElementById('evCase').value,addr,attorney:attSel.options[attSel.selectedIndex].text,attEmail:attSel.value,notes:document.getElementById('evNotes').value.trim()};
    events.push(ev);
    if(document.getElementById('evNotify').value==='yes'&&addr){
        const url='https://www.google.com/maps/dir/?api=1&destination='+encodeURIComponent(addr);
        const subj=encodeURIComponent(type+(ev.caseNum?' - '+ev.caseNum:'')+' - '+fmtDate(date));
        const body=encodeURIComponent('Hi '+ev.attorney.split(' ')[0]+',\n\nYou have been scheduled for:\n\nEvent: '+type+'\n'+(ev.caseNum?'Case: '+ev.caseNum+'\n':'')+'Date: '+fmtDate(date)+'\nTime: '+fmtTime(time)+'\nLocation: '+addr+'\n\nGoogle Maps Directions:\n'+url+'\n\n'+(ev.notes?'Notes: '+ev.notes+'\n\n':'')+'Thank you,\n'+BIZ+'\n'+PHONE);
        window.open('mailto:'+ev.attEmail+'?subject='+subj+'&body='+body,'_self');
    }
    closeModal('eventModal');renderEvents();renderDashboard();
    showToast('Event scheduled!','success');
}

function addInvLine(){
    const c=document.getElementById('invLineItems');
    const r=document.createElement('div');r.className='form-row-3 li-row';
    r.innerHTML='<div class="form-group"><label>Description</label><input type="text" placeholder="Legal service rendered"></div><div class="form-group"><label>Hours/Qty</label><input type="number" value="1" min="0.25" step="0.25"></div><div class="form-group"><label>Rate ($)</label><input type="number" placeholder="0.00" step="0.01"></div>';
    c.appendChild(r);
}

function createInvoice(){
    const client=document.getElementById('invClient').value.trim();
    const email=document.getElementById('invEmail').value.trim();
    if(!client||!email){showToast('Client name and email required.');return}
    invCount++;
    const num='INV-'+String(invCount).padStart(3,'0');
    const rows=document.querySelectorAll('#invLineItems .li-row');
    const items=[];
    rows.forEach(r=>{const inp=r.querySelectorAll('input');items.push({desc:inp[0].value.trim()||'Legal services',qty:parseFloat(inp[1].value)||1,price:parseFloat(inp[2].value)||0})});
    invoices.unshift({num,client,email,caseNum:document.getElementById('invCase').value,items,notes:document.getElementById('invTerms').value+(document.getElementById('invNotes').value.trim()?' - '+document.getElementById('invNotes').value.trim():''),date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}),status:'Pending'});
    closeModal('invoiceModal');renderInvoices();renderDashboard();
    showToast('Invoice #'+num+' created!','success');
}

function submitIntake(){
    const fn=document.getElementById('intFirstName').value.trim();
    const ln=document.getElementById('intLastName').value.trim();
    const email=document.getElementById('intEmail').value.trim();
    const phone=document.getElementById('intPhone').value.trim();
    if(!fn||!ln||!email){showToast('First name, last name, and email are required.');return}
    const incDate=document.getElementById('intIncidentDate').value;
    let solDate='';
    if(incDate){const d=new Date(incDate+'T00:00:00');d.setFullYear(d.getFullYear()+2);solDate=d.toISOString().split('T')[0]}
    caseCount++;
    const num='DI-2026-'+String(caseCount).padStart(3,'0');
    cases.unshift({num,client:fn+' '+ln,email,phone,type:document.getElementById('intCaseType').value,status:'Intake',solDate,incDate,attorney:'David Drake',attEmail:'david@drakeinjurylawyers.com',opposing:document.getElementById('intAtFault').value.trim(),opposingIns:document.getElementById('intAtFaultIns').value.trim(),feeType:'Contingency (33%)',desc:document.getElementById('intIncidentDesc').value.trim()});
    showToast('Case '+num+' created from intake for '+fn+' '+ln+'!','success');
    clearIntake();
    switchPage('cases',document.querySelectorAll('.nav-item')[2]);
    renderCases();renderDashboard();
}

function clearIntake(){
    ['intFirstName','intLastName','intDOB','intPhone','intEmail','intAddress','intIncidentDate','intIncidentLoc','intIncidentDesc','intInjuries','intDoctor','intClientIns','intPolicyNum','intAtFault','intAtFaultIns','intReportNum','intNotes'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=''});
}

// ========== TABS ==========
function switchCalTab(t,el){document.getElementById('calTab-deadlines').style.display=t==='deadlines'?'block':'none';document.getElementById('calTab-events').style.display=t==='events'?'block':'none';el.parentElement.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));el.classList.add('active')}
function switchBillTab(t,el){document.getElementById('billTab-invoices').style.display=t==='invoices'?'block':'none';document.getElementById('billTab-agreements').style.display=t==='agreements'?'block':'none';el.parentElement.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));el.classList.add('active')}

// ========== INIT ==========
renderDashboard();renderCases();renderSOL();renderDeadlines();renderEvents();renderInvoices();renderFeeAgreements();
try{document.getElementById('evDate').valueAsDate=new Date()}catch(e){}
document.querySelectorAll('.modal-overlay').forEach(m=>{m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('open')})});
</script>
</body>
</html>
